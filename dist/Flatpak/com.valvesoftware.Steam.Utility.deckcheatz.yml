# SPDX-FileCopyrightText: 2024 The DeckCheatz Developers
#
# SPDX-License-Identifier: Apache-2.0

app-id: com.valvesoftware.Steam.Utility.deckcheatz
runtime: com.valvesoftware.Steam
runtime-version: stable
sdk: org.freedesktop.Sdk//23.08
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
build-extension: true
appstream-compose: false
separate-locales: false
finish-args:
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
build-options:
  prefix: /app/utils/deckcheatz
  append-path: /usr/lib/sdk/rust-stable/bin
  env:
    CARGO_HOME: /run/build/rust-flatpak/cargo
  strip: true
modules:
  - name: rust-flatpak
    buildsystem: simple
    build-commands:
      - cargo --offline fetch --manifest-path Cargo.toml --verbose
      - cargo --offline build --release --verbose
      - install -Dm755 ./target/release/deckcheatz -t /app/utils/deckcheatz
    sources:
      - generated-sources.json
      - type: dir
        path: ../..
  - name: steamcompat
    build-options:
      env:
        PREFIX: ${FLATPAK_DEST}
    buildsystem: simple
    build-commands:
      - install -Dm644 -t ${FLATPAK_DEST}/share/steam/compatibilitytools.d/DeckCheatz ../Steam/compatibilitytool.vdf
      - install -Dm644 -t ${FLATPAK_DEST} ../Steam/toolmanifest.vdf
    sources:
      - type: file
        path: ../Steam/compatibilitytool.vdf
      - type: file
        path: ../Steam/toolmanifest.vdf

  - name: metadata
    buildsystem: simple
    build-commands:
      - install -Dm644 ./dist/Flatpak/${FLATPAK_ID}.metainfo.xml -t ${FLATPAK_DEST}/share/metainfo
    sources:
      - type: dir
        path: ../../
